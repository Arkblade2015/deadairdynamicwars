<?xml version="1.0" encoding="utf-8"?>
<mdscript name="DynamicWar" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="md.xsd">
	<cues>
		<cue name="Init" version="4">
			<actions>
				<do_if value="(not $ArgonCoalition?) or (not $TeladiCoalition?) or (not $ParanidCoalition?) or (not $HolyOrderCoalition?) or (not $PirateCoalition?)">
					<set_value name="$ArgonCoalition" exact="[faction.antigone, faction.argon, faction.hatikvah]"/>
					<set_value name="$HolyOrderCoalition" exact="[faction.holyorder]"/>
					<set_value name="$ParanidCoalition" exact="[faction.alliance, faction.paranid]"/>
					<set_value name="$TeladiCoalition" exact="[faction.ministry, faction.teladi]"/>
					<set_value name="$PirateCoalition" exact="[faction.scaleplate]"/>
				</do_if>
				<set_value name="$ExcludedFactions" exact="[faction.civilian, faction.criminal, faction.holyorderfanatic, faction.khaak, faction.player, faction.smuggler, faction.trinity, faction.visitor, faction.xenon]"/>
				<do_if value="(not $FactionTable?)">
					<set_value name="$FactionTable" exact="table[]" />
				</do_if>
			</actions>
			<patch sinceversion="4">
				<reset_cue cue="this"/>
			</patch>
			<cues>
				<cue name="DynamicWarTimer" instantiate="true" checkinterval="30min" checktime="player.age + 5min">
					<actions>
						<signal_cue_instantly cue="DynamicWarEventSelector" />
					</actions>
				</cue>
				<!-- This is where debug goes
				<cue name="DynamicWarDebug" instantiate="true" >
					<conditions>
						<event_long_range_scan_sent object="player.entity"/>
					</conditions>
					<actions>
						<signal_cue_instantly cue="DynamicWarEventSelector" />
					</actions>
				</cue>
				This is where it ends -->
				<cue name="DynamicWarEventSelector" instantiate="true">
					<conditions>
						<event_cue_signalled/>
					</conditions>
					<actions>
						<set_value name="$DynamicWarDebugChance" exact="false" />
						<do_if value="$DynamicWarEvent?">
							<remove_value name="$DynamicWarEvent" />
						</do_if>
						<!-- Choose event type -->
						<do_any>
							<set_value name="$DynamicWarEvent" exact="'Besties'" weight="5" />
							<set_value name="$DynamicWarEvent" exact="'BigBoost'" weight="25" />
							<set_value name="$DynamicWarEvent" exact="'SmallBoost'" weight="50" />
							<set_value name="$DynamicWarEvent" exact="'SmallBlow'" weight="50" />
							<set_value name="$DynamicWarEvent" exact="'BigBlow'" weight="25" />
							<set_value name="$DynamicWarEvent" exact="'Nemesis'" weight="5" />
							<set_value name="$DynamicWarEvent" exact="'Nothing'" weight="1" />
						</do_any>
						<debug_text text="'MOD: DeadAirDynamicWar -- %1 -- Event Chosen: %2'.[player.age,$DynamicWarEvent]" 
							context="false" filter="scripts" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
						<!-- Clean up old faction one -->
						<do_if value="$DynamicWarEventFaction?">
							<remove_value name="$DynamicWarEventFaction" />
						</do_if>
						<do_if value="$DynamicWarEventFactionTwo?">
							<remove_value name="$DynamicWarEventFactionTwo" />
						</do_if>
						<!-- If nothing then we don't need to do any more processing -->
						<do_if value="$DynamicWarEvent != 'Nothing'">
							<!-- find factions -->
							<get_factions_by_tag tag="tag.claimspace" result="$Claimspacelist" />
							<create_list name="$Peacefullist" />
							<get_factions_by_tag tag="tag.peaceful" result="$Peacefullist" />
							<!-- print out the results for debug -->
							<set_value name="$ClaimspacelistDebug" exact="player.age + ' Claimspace list unprocessed: '" />
							<do_all exact="$Claimspacelist.count" counter="$ClaimspacelistDebugCounter">
								<set_value name="$ClaimspacelistDebug" exact="$ClaimspacelistDebug + ' #' + $ClaimspacelistDebugCounter + ' ' + $Claimspacelist.{$ClaimspacelistDebugCounter}" />
							</do_all>
							<debug_to_file name="'DynamicWarEventSelector'" directory="'DynamicWar'" text="$ClaimspacelistDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<remove_value name="$ClaimspacelistDebug" />
							<remove_value name="$ClaimspacelistDebugCounter" />
							<append_list_elements name="$Peacefullist" other="$ExcludedFactions" />
							<!-- Remove peaceful factions and excluded factions -->
							<remove_from_list name="$Claimspacelist" list="$Peacefullist" multiple="true"/>
							<do_all exact="$Claimspacelist.count" counter="$ClaimspaceCounter" reverse="true">
								<do_if value="$Claimspacelist.{$ClaimspaceCounter}?">
									<do_if value="$Claimspacelist.{$ClaimspaceCounter} == null">
										<remove_value name="$Claimspacelist.{$ClaimspaceCounter}" />
										<continue/>
									</do_if>
								</do_if>
							</do_all>
							<set_value name="$FactionTableList" exact="$Claimspacelist" />
							<remove_value name="$ClaimspaceCounter" />
							<remove_value name="$Peacefullist" />
							<!-- print out the results for debug -->
							<set_value name="$ClaimspacelistDebug" exact="player.age + ' Claimspace list processed: '" />
							<do_all exact="$Claimspacelist.count" counter="$ClaimspacelistDebugCounter">
								<set_value name="$ClaimspacelistDebug" exact="$ClaimspacelistDebug + ' #' + $ClaimspacelistDebugCounter + ' ' + $Claimspacelist.{$ClaimspacelistDebugCounter}" />
							</do_all>
							<debug_to_file name="'DynamicWarEventSelector'" directory="'DynamicWar'" text="$ClaimspacelistDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<debug_to_file name="'DynamicWarEventSelector'" directory="'DynamicWar'" text="' '" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<remove_value name="$ClaimspacelistDebug" />
							<remove_value name="$ClaimspacelistDebugCounter" />
							<!-- Shuffle! -->
							<shuffle_list list="$Claimspacelist"/>
							<!-- Reduce to seven options and cleanup -->
							<do_all exact="$Claimspacelist.count" counter="$ClaimspaceCounter" reverse="true">
								<do_if value="$ClaimspaceCounter gt 7">
									<remove_value name="$Claimspacelist.{$ClaimspaceCounter}" />
								</do_if>
							</do_all>
							<remove_value name="$ClaimspaceCounter" />
							<!-- Get chance factor -->
							<create_list name="$PossibleFactionChance" />
							<include_actions ref="DynamicWarCalculateChance" />
							<!-- Choose random faction -->
							<do_any>
								<set_value name="$DynamicWarEventFaction" exact="if $Claimspacelist.{1}? then $Claimspacelist.{1} else null" weight="if ($Claimspacelist.{1}? and $PossibleFactionChance.{1}?) then $PossibleFactionChance.{1} else 0" />
								<set_value name="$DynamicWarEventFaction" exact="if $Claimspacelist.{2}? then $Claimspacelist.{2} else null" weight="if ($Claimspacelist.{2}? and $PossibleFactionChance.{2}?) then $PossibleFactionChance.{2} else 0" />
								<set_value name="$DynamicWarEventFaction" exact="if $Claimspacelist.{3}? then $Claimspacelist.{3} else null" weight="if ($Claimspacelist.{3}? and $PossibleFactionChance.{3}?) then $PossibleFactionChance.{3} else 0" />
								<set_value name="$DynamicWarEventFaction" exact="if $Claimspacelist.{4}? then $Claimspacelist.{4} else null" weight="if ($Claimspacelist.{4}? and $PossibleFactionChance.{4}?) then $PossibleFactionChance.{4} else 0" />
								<set_value name="$DynamicWarEventFaction" exact="if $Claimspacelist.{5}? then $Claimspacelist.{5} else null" weight="if ($Claimspacelist.{5}? and $PossibleFactionChance.{5}?) then $PossibleFactionChance.{5} else 0" />
								<set_value name="$DynamicWarEventFaction" exact="if $Claimspacelist.{6}? then $Claimspacelist.{6} else null" weight="if ($Claimspacelist.{6}? and $PossibleFactionChance.{6}?) then $PossibleFactionChance.{6} else 0" />
								<set_value name="$DynamicWarEventFaction" exact="if $Claimspacelist.{7}? then $Claimspacelist.{7} else null" weight="if ($Claimspacelist.{7}? and $PossibleFactionChance.{7}?) then $PossibleFactionChance.{7} else 0" />
							</do_any>
							<debug_text text="'MOD: DeadAirDynamicWar -- %1 -- Faction selected: %2 -- Chance: %3'.[player.age,$DynamicWarEventFaction,@$FactionTable.{$DynamicWarEventFaction}]" 
								context="false" filter="scripts" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<!-- Remove selected faction from possible factions since it will be used again -->
							<do_all exact="$Claimspacelist.count" counter="$ClaimspaceCounter" reverse="true">
								<debug_text text="'MOD: DeadAirDynamicWar -- %1 -- Faction possibilities: %2 -- Chance: %3'.[player.age,$Claimspacelist.{$ClaimspaceCounter},@$FactionTable.{$Claimspacelist.{$ClaimspaceCounter}}]" 
									context="false" filter="scripts" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
								<do_if value="$Claimspacelist.{$ClaimspaceCounter} == $DynamicWarEventFaction">
									<remove_value name="$Claimspacelist.{$ClaimspaceCounter}" />
								</do_if>
							</do_all>
							<!-- Clean up counter, debug, possiblefactionchance and old faction two -->
							<remove_value name="$ClaimspacelistDebug" />
							<remove_value name="$ClaimspacelistDebugCounter" />
							<remove_value name="$PossibleFactionChance" />
							<remove_value name="$ClaimspaceCounter" />
							<!-- Shuffle! -->
							<shuffle_list list="$Claimspacelist"/>
							<!-- Reduce to six options and cleanup -->
							<do_all exact="$Claimspacelist.count" counter="$ClaimspaceCounter" reverse="true">
								<do_if value="$ClaimspaceCounter gt 6">
									<remove_value name="$Claimspacelist.{$ClaimspaceCounter}" />
								</do_if>
							</do_all>
							<remove_value name="$ClaimspaceCounter" />
							<!-- Get military strength factor -->
							<create_list name="$PossibleFactionMilStrength" />
							<create_list name="$PossibleFactionMiscModifierList" />
							<include_actions ref="DynamicWarCalculateMilStrengthFactor" />
							<include_actions ref="DynamicWarCalculateMisc" />
							<!-- Get chance factor -->
							<create_list name="$PossibleFactionChance" />
							<include_actions ref="DynamicWarCalculateChance" />
							<!-- Select $FactionTwo -->
							<do_any>
								<set_value name="$DynamicWarEventFactionTwo" exact="if $Claimspacelist.{1}? then $Claimspacelist.{1} else null" weight="if ($Claimspacelist.{1}? and $PossibleFactionMilStrength.{1}? and $PossibleFactionMiscModifierList.{1} and $PossibleFactionChance.{1}?) then ($PossibleFactionChance.{1} * $PossibleFactionMilStrength.{1} * $PossibleFactionMiscModifierList.{1}) else 0" />
								<set_value name="$DynamicWarEventFactionTwo" exact="if $Claimspacelist.{2}? then $Claimspacelist.{2} else null" weight="if ($Claimspacelist.{2}? and $PossibleFactionMilStrength.{2}? and $PossibleFactionMiscModifierList.{2} and $PossibleFactionChance.{2}?) then ($PossibleFactionChance.{2} * $PossibleFactionMilStrength.{2} * $PossibleFactionMiscModifierList.{2}) else 0" />
								<set_value name="$DynamicWarEventFactionTwo" exact="if $Claimspacelist.{3}? then $Claimspacelist.{3} else null" weight="if ($Claimspacelist.{3}? and $PossibleFactionMilStrength.{3}? and $PossibleFactionMiscModifierList.{3} and $PossibleFactionChance.{3}?) then ($PossibleFactionChance.{3} * $PossibleFactionMilStrength.{3} * $PossibleFactionMiscModifierList.{3}) else 0" />
								<set_value name="$DynamicWarEventFactionTwo" exact="if $Claimspacelist.{4}? then $Claimspacelist.{4} else null" weight="if ($Claimspacelist.{4}? and $PossibleFactionMilStrength.{4}? and $PossibleFactionMiscModifierList.{4} and $PossibleFactionChance.{4}?) then ($PossibleFactionChance.{4} * $PossibleFactionMilStrength.{4} * $PossibleFactionMiscModifierList.{4}) else 0" />
								<set_value name="$DynamicWarEventFactionTwo" exact="if $Claimspacelist.{5}? then $Claimspacelist.{5} else null" weight="if ($Claimspacelist.{5}? and $PossibleFactionMilStrength.{5}? and $PossibleFactionMiscModifierList.{5} and $PossibleFactionChance.{5}?) then ($PossibleFactionChance.{5} * $PossibleFactionMilStrength.{5} * $PossibleFactionMiscModifierList.{5}) else 0" />
								<set_value name="$DynamicWarEventFactionTwo" exact="if $Claimspacelist.{6}? then $Claimspacelist.{6} else null" weight="if ($Claimspacelist.{6}? and $PossibleFactionMilStrength.{6}? and $PossibleFactionMiscModifierList.{6} and $PossibleFactionChance.{6}?) then ($PossibleFactionChance.{6} * $PossibleFactionMilStrength.{6} * $PossibleFactionMiscModifierList.{6}) else 0" />
							</do_any>
							<debug_text text="'MOD: DeadAirDynamicWar -- %1 -- Factiontwo selected: %2 -- Chance: %3'.[player.age,$DynamicWarEventFactionTwo,@$FactionTable.{$DynamicWarEventFactionTwo}]" 
								context="false" filter="scripts" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<!-- print out the results for debug -->
							<set_value name="$FactionSelectionDebug" exact="player.age + ' - ' + $DynamicWarEvent + ' - ' + $DynamicWarEventFaction + ' and ' + $DynamicWarEventFactionTwo" />
							<debug_to_file name="'DynamicWarEventSelector'" directory="'DynamicWar'" text="$FactionSelectionDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<set_value name="$FactionSelectionDebug" exact="player.age + ' DynamicWarEventFactionTwo possibilities: '" />
							<do_all exact="$Claimspacelist.count" counter="$ClaimspacelistDebugCounter">
								<debug_text text="'MOD: DeadAirDynamicWar -- %1 -- Factiontwo possibilities: %2 -- Chance: %3 -- MilStrengthFactor: %4 -- MiscFactor: %5'.[player.age,$Claimspacelist.{$ClaimspacelistDebugCounter},
									@$FactionTable.{$Claimspacelist.{$ClaimspacelistDebugCounter}},$PossibleFactionMilStrength.{$ClaimspacelistDebugCounter},$PossibleFactionMiscModifierList.{$ClaimspacelistDebugCounter}]" 
									context="false" filter="scripts" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
								<set_value name="$FactionSelectionDebug" exact="$FactionSelectionDebug + ' #' + $ClaimspacelistDebugCounter + ' ' + $Claimspacelist.{$ClaimspacelistDebugCounter} + ' MilStrengthFactor: ' + $PossibleFactionMilStrength.{$ClaimspacelistDebugCounter} + ' MiscFactor: ' + $PossibleFactionMiscModifierList.{$ClaimspacelistDebugCounter}" />
							</do_all>
							<debug_to_file name="'DynamicWarEventSelector'" directory="'DynamicWar'" text="$FactionSelectionDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<set_value name="$FactionSelectionDebug" exact="player.age + ' DynamicWarEventFactionTwo chance: '" />
							<remove_value name="$ClaimspacelistDebugCounter" />
							<do_all exact="$Claimspacelist.count" counter="$ClaimspacelistDebugCounter">
								<set_value name="$FactionSelectionDebug" exact="$FactionSelectionDebug + ' #' + $ClaimspacelistDebugCounter + ' ' + $Claimspacelist.{$ClaimspacelistDebugCounter} + ' Chance: ' + $PossibleFactionChance.{$ClaimspacelistDebugCounter}" />
							</do_all>
							<debug_to_file name="'DynamicWarEventSelector'" directory="'DynamicWar'" text="$FactionSelectionDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<debug_to_file name="'DynamicWarEventSelector'" directory="'DynamicWar'" text="' '" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<remove_value name="$FactionSelectionDebug" />
							<remove_value name="$ClaimspacelistDebugCounter" />
							<!-- Update chance factor -->
							<include_actions ref="DynamicWarCalculateChance" />
							<!-- Execute the relation changes -->
							<include_actions ref="DynamicWarEventExecute" />
						</do_if>
						<do_if value="$DynamicWarEvent == 'Nothing'">
							<set_value name="$NothingDebug" exact="player.age + ' - ' + $DynamicWarEvent" />
							<debug_to_file name="'DynamicWarEventSelector'" directory="'DynamicWar'" text="$NothingDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<debug_to_file name="'DynamicWarEventSelector'" directory="'DynamicWar'" text="' '" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
						</do_if>
						<!-- Clean up since this round is done -->
						<remove_value name="$DynamicWarEvent" />
						<remove_value name="$DynamicWarEventFaction" />
						<remove_value name="$DynamicWarEventFactionTwo" />
						<remove_value name="$PossibleFactionChance" />
						<remove_value name="$PossibleFactionMilStrength" />
						<remove_value name="$PossibleFactionMiscModifierList" />
					</actions>
				</cue>
				<library name="DynamicWarEventExecute">
					<actions>
						<!-- Let's set the mood -->
						<set_value name="$Mood" exact="$DynamicWarEventFaction.mood.aggression"/>
						<set_value name="$Mood2" exact="$DynamicWarEventFactionTwo.mood.aggression"/>
						<!--Break time -->
						<do_if value="$DynamicWarEvent == 'BigBoost'">
							<set_value name="$FactionOne" exact="$DynamicWarEventFaction" />
							<set_value name="$FactionTwo" exact="$DynamicWarEventFactionTwo" />
							<set_value name="$BigBoostDebug" exact="'Big Boost - ' + $FactionOne + ' and ' + $FactionTwo + ' - Before: ' + $FactionOne.relationto.{$FactionTwo}" />
							<set_value name="$OldRelation" exact="$FactionOne.relationto.{$FactionTwo}" />
							<set_faction_relation faction="$FactionOne" otherfaction="$FactionTwo" value="([$FactionOne.relationto.{$FactionTwo} + 0.1f, 1].min)" />
							<set_value name="$NewRelation" exact="([$FactionOne.relationto.{$FactionTwo}, 1].min)" />
							<set_faction_relation faction="$FactionTwo" otherfaction="$FactionOne" value="$NewRelation" />
							<set_value name="$BigBoostDebug" exact="$BigBoostDebug + ' - After: ' + $FactionOne.relationto.{$FactionTwo}" />
							<debug_to_file name="'DynamicWarEventExecute'" directory="'DynamicWar'" text="$BigBoostDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<debug_to_file name="'DynamicWarEventExecute'" directory="'DynamicWar'" text="' '" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<do_any>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="moodlevel.verylow" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="moodlevel.low" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="$Mood" weight="50"/>
							</do_any>
							<do_any>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="moodlevel.verylow" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="moodlevel.low" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="$Mood2" weight="50"/>
							</do_any>
						</do_if>
						<do_if value="$DynamicWarEvent == 'SmallBoost'">
							<set_value name="$FactionOne" exact="$DynamicWarEventFaction" />
							<set_value name="$FactionTwo" exact="$DynamicWarEventFactionTwo" />
							<set_value name="$SmallBoostDebug" exact="'Small Boost - ' + $FactionOne + ' and ' + $FactionTwo + ' - Before: ' + $FactionOne.relationto.{$FactionTwo}" />
							<set_value name="$OldRelation" exact="$FactionOne.relationto.{$FactionTwo}" />
							<set_faction_relation faction="$FactionOne" otherfaction="$FactionTwo" value="([$FactionOne.relationto.{$FactionTwo} + 0.0032f, 1].min)" />
							<set_value name="$NewRelation" exact="([$FactionOne.relationto.{$FactionTwo}, 1].min)" />
							<set_faction_relation faction="$FactionTwo" otherfaction="$FactionOne" value="$NewRelation" />
							<set_value name="$SmallBoostDebug" exact="$SmallBoostDebug + ' - After: ' + $FactionOne.relationto.{$FactionTwo}" />
							<debug_to_file name="'DynamicWarEventExecute'" directory="'DynamicWar'" text="$SmallBoostDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<debug_to_file name="'DynamicWarEventExecute'" directory="'DynamicWar'" text="' '" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<do_any>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="moodlevel.low" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="moodlevel.normal" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="$Mood" weight="50"/>
							</do_any>
							<do_any>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="moodlevel.low" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="moodlevel.normal" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="$Mood2" weight="50"/>
							</do_any>
						</do_if>
						<do_if value="$DynamicWarEvent == 'SmallBlow'">
							<set_value name="$FactionOne" exact="$DynamicWarEventFaction" />
							<set_value name="$FactionTwo" exact="$DynamicWarEventFactionTwo" />
							<set_value name="$SmallBlowDebug" exact="'Small Blow - ' + $FactionOne + ' and ' + $FactionTwo + ' - Before: ' + $FactionOne.relationto.{$FactionTwo}" />
							<set_value name="$OldRelation" exact="$FactionOne.relationto.{$FactionTwo}" />
							<set_faction_relation faction="$FactionOne" otherfaction="$FactionTwo" value="([$FactionOne.relationto.{$FactionTwo} - 0.0032f, -1].max)" />
							<set_value name="$NewRelation" exact="([$FactionOne.relationto.{$FactionTwo}, -1].max)" />
							<set_faction_relation faction="$FactionTwo" otherfaction="$FactionOne" value="$NewRelation" />
							<set_value name="$SmallBlowDebug" exact="$SmallBlowDebug + ' - After: ' + $FactionOne.relationto.{$FactionTwo}" />
							<debug_to_file name="'DynamicWarEventExecute'" directory="'DynamicWar'" text="$SmallBlowDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<debug_to_file name="'DynamicWarEventExecute'" directory="'DynamicWar'" text="' '" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<do_any>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="$Mood" weight="50"/>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="moodlevel.normal" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="moodlevel.high" weight="25"/>
							</do_any>
							<do_any>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="$Mood2" weight="50"/>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="moodlevel.normal" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="moodlevel.high" weight="25"/>
							</do_any>
						</do_if>
						<do_if value="$DynamicWarEvent == 'BigBlow'">
							<set_value name="$FactionOne" exact="$DynamicWarEventFaction" />
							<set_value name="$FactionTwo" exact="$DynamicWarEventFactionTwo" />
							<set_value name="$BigBlowDebug" exact="'Big Blow - ' + $FactionOne + ' and ' + $FactionTwo + ' - Before: ' + $FactionOne.relationto.{$FactionTwo}" />
							<set_value name="$OldRelation" exact="$FactionOne.relationto.{$FactionTwo}" />
							<set_faction_relation faction="$FactionOne" otherfaction="$FactionTwo" value="([$FactionOne.relationto.{$FactionTwo} - 0.1f, -1].max)" />
							<set_value name="$NewRelation" exact="([$FactionOne.relationto.{$FactionTwo}, -1].max)" />
							<set_faction_relation faction="$FactionTwo" otherfaction="$FactionOne" value="$NewRelation" />
							<set_value name="$BigBlowDebug" exact="$BigBlowDebug + ' - After: ' + $FactionOne.relationto.{$FactionTwo}" />
							<debug_to_file name="'DynamicWarEventExecute'" directory="'DynamicWar'" text="$BigBlowDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<debug_to_file name="'DynamicWarEventExecute'" directory="'DynamicWar'" text="' '" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<do_any>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="$Mood" weight="50"/>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="moodlevel.normal" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="moodlevel.high" weight="25"/>
							</do_any>
							<do_any>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="$Mood2" weight="50"/>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="moodlevel.normal" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="moodlevel.high" weight="25"/>
							</do_any>
						</do_if>
						<do_if value="$DynamicWarEvent == 'Nemesis'">
							<set_value name="$FactionOne" exact="$DynamicWarEventFaction" />
							<set_value name="$FactionTwo" exact="$DynamicWarEventFactionTwo" />
							<set_value name="$NemesisDebug" exact="'Nemesis - ' + $FactionOne + ' and ' + $FactionTwo + ' - Before: ' + $FactionOne.relationto.{$FactionTwo}" />
							<set_value name="$OldRelation" exact="$FactionOne.relationto.{$FactionTwo}" />
							<set_faction_relation faction="$FactionOne" otherfaction="$FactionTwo" value="-1.0" />
							<set_value name="$NewRelation" exact="-1.0" />
							<set_faction_relation faction="$FactionTwo" otherfaction="$FactionOne" value="$NewRelation" />
							<set_value name="$NemesisDebug" exact="$NemesisDebug + ' - After: ' + $FactionOne.relationto.{$FactionTwo}" />
							<debug_to_file name="'DynamicWarEventExecute'" directory="'DynamicWar'" text="$NemesisDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<debug_to_file name="'DynamicWarEventExecute'" directory="'DynamicWar'" text="' '" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<do_any>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="$Mood" weight="50"/>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="moodlevel.high" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="moodlevel.veryhigh" weight="25"/>
							</do_any>
							<do_any>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="$Mood2" weight="50"/>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="moodlevel.high" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="moodlevel.veryhigh" weight="25"/>
							</do_any>
						</do_if>
						<do_if value="$DynamicWarEvent == 'Besties'">
							<set_value name="$FactionOne" exact="$DynamicWarEventFaction" />
							<set_value name="$FactionTwo" exact="$DynamicWarEventFactionTwo" />
							<set_value name="$BestiesDebug" exact="'Besties - ' + $FactionOne + ' and ' + $FactionTwo + ' - Before: ' + $FactionOne.relationto.{$FactionTwo}" />
							<set_value name="$OldRelation" exact="$FactionOne.relationto.{$FactionTwo}" />
							<set_faction_relation faction="$FactionOne" otherfaction="$FactionTwo" value="0.99" />
							<set_value name="$NewRelation" exact="0.99" />
							<set_faction_relation faction="$FactionTwo" otherfaction="$FactionOne" value="$NewRelation" />
							<set_value name="$BestiesDebug" exact="$BestiesDebug + ' - After: ' + $FactionOne.relationto.{$FactionTwo}" />
							<debug_to_file name="'DynamicWarEventExecute'" directory="'DynamicWar'" text="$BestiesDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<debug_to_file name="'DynamicWarEventExecute'" directory="'DynamicWar'" text="' '" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
							<do_any>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="moodlevel.verylow" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="moodlevel.low" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFaction" type="aggression" level="$Mood" weight="50"/>
							</do_any>
							<do_any>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="moodlevel.verylow" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="moodlevel.low" weight="25"/>
								<set_faction_mood faction="$DynamicWarEventFactionTwo" type="aggression" level="$Mood2" weight="50"/>
							</do_any>
						</do_if>
						<remove_value name="$Mood" />
						<remove_value name="$Mood2" />
						<include_actions ref="DynamicWarEventNotification" />
					</actions>
				</library>
				<library name="DynamicWarEventNotification">
					<actions>
						<!-- Big ups to Jack the Stripper(marksmango) for ideas-->
						<set_value name="$FactionOneNames" exact="$DynamicWarEventFaction.name" />
						<!-- Grammar is kind of important -->
						<set_value name="$IsAre" exact="' is '" />
						<!-- Repeat for DynamicWarEventFactionTwo -->
						<set_value name="$FactionTwoNames" exact="$DynamicWarEventFactionTwo.name" />
						
						<do_if value="$DynamicWarEvent == 'BigBoost' or ($DynamicWarEvent == 'Besties')">
							<do_if value="($OldRelation ge 0) and ($NewRelation gt 0)">
								<do_if value="($NewRelation gt 0) and ($NewRelation lt 0.1)">
									<set_value name="$Message" exact="{33232471,101}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation ge 0.1) and ($NewRelation lt 1.0)">
									<set_value name="$Message" exact="{33232471,102}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation == 1.0)">
									<set_value name="$Message" exact="{33232471,103}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<show_notification priority="6" text="$Message" />
								<do_any>
									<set_value name="$FlavorText" exact="{33232471,201}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<set_value name="$FlavorText" exact="{33232471,202}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
								</do_any>
								<write_to_logbook category="news" title="$Message" text="$FlavorText" />
							</do_if>
							<do_if value="($OldRelation lt 0) and ($NewRelation ge 0)">
								<do_if value="($NewRelation gt 0) and ($NewRelation lt 0.1)">
									<set_value name="$Message" exact="{33232471,104}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation ge 0.1) and ($NewRelation lt 1.0)">
									<set_value name="$Message" exact="{33232471,105}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation == 1.0)">
									<set_value name="$Message" exact="{33232471,106}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<show_notification priority="8" text="$Message" />
								<do_any>
									<set_value name="$FlavorText" exact="{33232471,203}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<set_value name="$FlavorText" exact="{33232471,204}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<set_value name="$FlavorText" exact="{33232471,205}.[$FactionTwoNames,$FactionOneNames]" weight="25"/>
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
								</do_any>
								<write_to_logbook category="news" title="$Message" text="$FlavorText" />
							</do_if>
							<do_if value="($OldRelation lt 0) and ($NewRelation lt 0)">
								<do_if value="($NewRelation lt 0) and ($NewRelation gt -0.1)">
									<set_value name="$Message" exact="{33232471,107}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation le -0.1) and ($NewRelation gt -0.32)">
									<set_value name="$Message" exact="{33232471,108}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation le -0.32) and ($NewRelation gt -1.0)">
									<set_value name="$Message" exact="{33232471,109}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<show_notification priority="7" text="$Message" />
								<do_any>
									<set_value name="$FlavorText" exact="{33232471,206}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<set_value name="$FlavorText" exact="{33232471,207}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
								</do_any>
								<write_to_logbook category="news" title="$Message" text="$FlavorText" />
							</do_if>
						</do_if>
						<do_if value="$DynamicWarEvent == 'SmallBoost'">
							<do_if value="($OldRelation ge 0) and ($NewRelation gt 0)">
								<do_if value="($NewRelation gt 0) and ($NewRelation lt 0.1)">
									<set_value name="$Message" exact="{33232471,110}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation ge 0.1) and ($NewRelation lt 1.0)">
									<set_value name="$Message" exact="{33232471,111}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<show_notification priority="5" text="$Message" />
								<do_any>
									<set_value name="$FlavorText" exact="{33232471,208}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<set_value name="$FlavorText" exact="{33232471,209}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
								</do_any>
								<write_to_logbook category="news" title="$Message" text="$FlavorText" />
							</do_if>
							<do_if value="($OldRelation lt 0) and ($NewRelation ge 0)">
								<set_value name="$Message" exact="{33232471,112}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								<show_notification priority="7" text="$Message" />
								<do_any>
									<set_value name="$FlavorText" exact="{33232471,210}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<set_value name="$FlavorText" exact="{33232471,211}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
								</do_any>
								<write_to_logbook category="news" title="$Message" text="$FlavorText" />
							</do_if>
							<do_if value="($OldRelation lt 0) and ($NewRelation lt 0)">
								<do_if value="($NewRelation lt 0) and ($NewRelation gt -0.1)">
									<set_value name="$Message" exact="{33232471,113}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation le -0.1) and ($NewRelation gt -0.32)">
									<set_value name="$Message" exact="{33232471,114}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation le -0.32) and ($NewRelation gt -1.0)">
									<set_value name="$Message" exact="{33232471,115}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<show_notification priority="7" text="$Message" />
								<do_any>
									<set_value name="$FlavorText" exact="{33232471,212}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<set_value name="$FlavorText" exact="{33232471,213}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
								</do_any>
								<write_to_logbook category="news" title="$Message" text="$FlavorText" />
							</do_if>
						</do_if>
						<do_if value="$DynamicWarEvent == 'SmallBlow'">
							<do_if value="($OldRelation gt 0) and ($NewRelation gt 0)">
								<do_if value="($NewRelation gt 0) and ($NewRelation lt 0.1)">
									<set_value name="$Message" exact="{33232471,116}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation ge 0.1) and ($NewRelation lt 1.0)">
									<set_value name="$Message" exact="{33232471,117}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<show_notification priority="6" text="$Message" />
								<do_any>
									<set_value name="$FlavorText" exact="{33232471,214}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<set_value name="$FlavorText" exact="{33232471,215}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
								</do_any>
								<write_to_logbook category="news" title="$Message" text="$FlavorText" />
							</do_if>
							<do_if value="($OldRelation lt 0) and ($NewRelation lt 0)">
								<do_if value="($NewRelation lt 0) and ($NewRelation gt -0.1)">
									<set_value name="$Message" exact="{33232471,118}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation le -0.1) and ($NewRelation gt -0.32)">
									<set_value name="$Message" exact="{33232471,119}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation le -0.32) and ($NewRelation gt -1.0)">
									<set_value name="$Message" exact="{33232471,120}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation == -1.0)">
									<set_value name="$Message" exact="{33232471,121}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<show_notification priority="5" text="$Message" />
								<do_any>
									<set_value name="$FlavorText" exact="{33232471,216}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<set_value name="$FlavorText" exact="{33232471,217}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
								</do_any>
								<write_to_logbook category="news" title="$Message" text="$FlavorText" />
							</do_if>
							<do_if value="($OldRelation ge 0) and ($NewRelation lt 0)">
								<do_if value="($NewRelation lt 0) and ($NewRelation gt -0.1)">
									<set_value name="$Message" exact="{33232471,122}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation le -0.1) and ($NewRelation gt -0.32)">
									<set_value name="$Message" exact="{33232471,123}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation le -0.32) and ($NewRelation gt -1.0)">
									<set_value name="$Message" exact="{33232471,124}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation == -1.0)">
									<set_value name="$Message" exact="{33232471,125}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<show_notification priority="7" text="$Message" />
								<do_any>
									<set_value name="$FlavorText" exact="{33232471,218}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<set_value name="$FlavorText" exact="{33232471,219}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
								</do_any>
								<write_to_logbook category="news" title="$Message" text="$FlavorText" />
							</do_if>
						</do_if>
						<do_if value="($DynamicWarEvent == 'BigBlow') or ($DynamicWarEvent == 'Nemesis')">
							<do_if value="($OldRelation gt 0) and ($NewRelation gt 0)">
								<do_if value="($NewRelation gt 0) and ($NewRelation lt 0.1)">
									<set_value name="$Message" exact="{33232471,126}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation ge 0.1) and ($NewRelation lt 1.0)">
									<set_value name="$Message" exact="{33232471,127}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<show_notification priority="6" text="$Message" />
								<do_any>
									<set_value name="$FlavorText" exact="{33232471,220}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<set_value name="$FlavorText" exact="{33232471,221}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
								</do_any>
								<write_to_logbook category="news" title="$Message" text="$FlavorText" />
							</do_if>
							<do_if value="($OldRelation lt 0) and ($NewRelation lt 0)">
								<do_if value="($NewRelation lt 0) and ($NewRelation gt -0.1)">
									<set_value name="$Message" exact="{33232471,128}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation le -0.1) and ($NewRelation gt -0.32)">
									<set_value name="$Message" exact="{33232471,129}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation le -0.32) and ($NewRelation gt -1.0)">
									<set_value name="$Message" exact="{33232471,130}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation == -1.0)">
									<set_value name="$Message" exact="{33232471,131}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<show_notification priority="6" text="$Message" />
								<do_any>
									<set_value name="$FlavorText" exact="{33232471,222}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<set_value name="$FlavorText" exact="{33232471,223}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
									<!--<set_value name="$FlavorText" exact="'Story'" weight="25"/>-->
								</do_any>
								<write_to_logbook category="news" title="$Message" text="$FlavorText" />
							</do_if>
							<do_if value="($OldRelation ge 0) and ($NewRelation lt 0)">
								<do_if value="($NewRelation lt 0) and ($NewRelation gt -0.1)">
									<set_value name="$Message" exact="{33232471,132}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation le -0.1) and ($NewRelation gt -0.32)">
									<set_value name="$Message" exact="{33232471,133}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation le -0.32) and ($NewRelation gt -1.0)">
									<set_value name="$Message" exact="{33232471,134}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<do_if value="($NewRelation == -1.0)">
									<set_value name="$Message" exact="{33232471,135}.[$FactionOneNames,$FactionTwoNames,$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue]" />
								</do_if>
								<show_notification priority="8" text="$Message" />
								<do_any>
									<set_value name="$FlavorText" exact="{33232471,224}.[$FactionTwoNames,$FactionOneNames]" weight="25"/>
									<set_value name="$FlavorText" exact="{33232471,225}.[$FactionOneNames,$FactionTwoNames]" weight="25"/>
									<set_value name="$FlavorText" exact="{33232471,226}.[$FactionTwoNames,$FactionOneNames,$FactionOneNames]" weight="25"/>
									<set_value name="$FlavorText" exact="{33232471,227}.[$FactionTwoNames,$FactionOneNames]" weight="25"/>
								</do_any>
								<write_to_logbook category="news" title="$Message" text="$FlavorText" />
							</do_if>
						</do_if>
					</actions>
				</library>
				<library name="DynamicWarCalculateMilStrengthFactor">
					<actions>
						<do_if value="$DynamicWarEventFaction? and $DynamicWarEvent?">
							<!-- Comparison favors weakness -->
							<do_if value="($DynamicWarEvent == 'BigBoost') or ($DynamicWarEvent == 'Besties') or ($DynamicWarEvent == 'SmallBoost')">
								<!-- We need to calculate the first factions strength -->
								<find_ship_by_true_owner groupname="$DynamicWarEventFactionMilShips" space="player.galaxy" multiple="true" faction="$DynamicWarEventFaction" primarypurpose="purpose.fight" append="true" />
								<find_sector groupname="$DynamicWarEventFactionSectors" space="player.galaxy" multiple="true" owner="$DynamicWarEventFaction" append="true" />
								<!-- print out results for debug -->
								<set_value name="$MilStrengthDebug" exact="player.age + ' - ' + $DynamicWarEvent + ' - ' + $DynamicWarEventFaction + ' - Ships: ' + $DynamicWarEventFactionMilShips.count + ' - Sectors: ' + $DynamicWarEventFactionSectors.count" />
								<debug_to_file name="'DynamicWarCalculateMilStrengthFactor'" directory="'DynamicWar'" text="$MilStrengthDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
								<debug_to_file name="'DynamicWarCalculateMilStrengthFactor'" directory="'DynamicWar'" text="' '" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
								<!-- Now calculate the possible factions in Claimspacelist -->
								<do_all exact="$Claimspacelist.count" counter="$ClaimspaceCounter">
									<find_ship_by_true_owner groupname="$PossibleFactionMilShips" space="player.galaxy" multiple="true" faction="$Claimspacelist.{$ClaimspaceCounter}" primarypurpose="purpose.fight" append="true" />
									<find_sector groupname="$PossibleFactionSectors" space="player.galaxy" multiple="true" owner="$Claimspacelist.{$ClaimspaceCounter}" append="true" />
									<append_to_list name="$PossibleFactionMilStrength" exact="[((($DynamicWarEventFactionMilShips.count)f / ($PossibleFactionMilShips.count)f) * (($DynamicWarEventFactionSectors.count)f / ($PossibleFactionSectors.count)f)), 3].min" />
									<set_value name="$MilStrengthDebug" exact="player.age + ' - ' + $Claimspacelist.{$ClaimspaceCounter}.name + ' - Ships: ' + $PossibleFactionMilShips.count + ' - Sectors: ' + $PossibleFactionSectors.count + ' - MilStrengthFactor: ' + $PossibleFactionMilStrength.{$ClaimspaceCounter}" />
									<debug_to_file name="'DynamicWarCalculateMilStrengthFactor'" directory="'DynamicWar'" text="$MilStrengthDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
									<debug_to_file name="'DynamicWarCalculateMilStrengthFactor'" directory="'DynamicWar'" text="' '" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
									<remove_value name="$PossibleFactionMilShips" />
									<remove_value name="$PossibleFactionSectors" />
									<remove_value name="$MilStrengthDebug" />
								</do_all>
								<remove_value name="$DynamicWarEventFactionMilShips" />
								<remove_value name="$DynamicWarEventFactionSectors" />
								<remove_value name="$ClaimspaceCounter" />
							</do_if>
							<!-- Comparison favors strength -->
							<do_if value="($DynamicWarEvent == 'SmallBlow') or ($DynamicWarEvent == 'BigBlow') or ($DynamicWarEvent == 'Nemesis')">
								<!-- We need to calculate the first factions strength -->
								<find_ship_by_true_owner groupname="$DynamicWarEventFactionMilShips" space="player.galaxy" multiple="true" faction="$DynamicWarEventFaction" primarypurpose="purpose.fight" append="true" />
								<find_sector groupname="$DynamicWarEventFactionSectors" space="player.galaxy" multiple="true" owner="$DynamicWarEventFaction" append="true" />
								<!-- print out results for debug -->
								<set_value name="$MilStrengthDebug" exact="player.age + ' - ' + $DynamicWarEvent + ' - ' + $DynamicWarEventFaction + ' - Ships: ' + $DynamicWarEventFactionMilShips.count + ' - Sectors: ' + $DynamicWarEventFactionSectors.count" />
								<debug_to_file name="'DynamicWarCalculateMilStrengthFactor'" directory="'DynamicWar'" text="$MilStrengthDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
								<debug_to_file name="'DynamicWarCalculateMilStrengthFactor'" directory="'DynamicWar'" text="' '" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
								<!-- Now calculate the possible factions in Claimspacelist -->
								<do_all exact="$Claimspacelist.count" counter="$ClaimspaceCounter">
									<find_ship_by_true_owner groupname="$PossibleFactionMilShips" space="player.galaxy" multiple="true" faction="$Claimspacelist.{$ClaimspaceCounter}" primarypurpose="purpose.fight" append="true" />
									<find_sector groupname="$PossibleFactionSectors" space="player.galaxy" multiple="true" owner="$Claimspacelist.{$ClaimspaceCounter}" append="true" />
									<append_to_list name="$PossibleFactionMilStrength" exact="[((($PossibleFactionMilShips.count)f / ($DynamicWarEventFactionMilShips.count)f) * (($PossibleFactionSectors.count)f / ($DynamicWarEventFactionSectors.count)f)), 3].min" />
									<set_value name="$MilStrengthDebug" exact="player.age + ' - ' + $Claimspacelist.{$ClaimspaceCounter}.name + ' - Ships: ' + $PossibleFactionMilShips.count + ' - Sectors: ' + $PossibleFactionSectors.count + ' - MilStrengthFactor: ' + $PossibleFactionMilStrength.{$ClaimspaceCounter}" />
									<debug_to_file name="'DynamicWarCalculateMilStrengthFactor'" directory="'DynamicWar'" text="$MilStrengthDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
									<debug_to_file name="'DynamicWarCalculateMilStrengthFactor'" directory="'DynamicWar'" text="' '" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
									<remove_value name="$PossibleFactionMilShips" />
									<remove_value name="$PossibleFactionSectors" />
									<remove_value name="$MilStrengthDebug" />
								</do_all>
								<remove_value name="$DynamicWarEventFactionMilShips" />
								<remove_value name="$DynamicWarEventFactionSectors" />
								<remove_value name="$ClaimspaceCounter" />
							</do_if>
						</do_if>
					</actions>
				</library>
				<library name="DynamicWarCalculateChance">
					<actions>
						<!-- set up the table if not already set up -->
						<do_if value="(not $FactionTable?)">
							<set_value name="$FactionTable" exact="table[]" />
						</do_if>
						<!-- use FactionTableList from above -->
						<!-- update chance only after factions have been selected -->
						<do_if value="$DynamicWarEventFaction? and $DynamicWarEventFactionTwo?">
							<do_all exact="$FactionTableList.count" counter="$FactionTableListCounter">
								<do_if value="($FactionTableList.{$FactionTableListCounter} == $DynamicWarEventFaction) or ($FactionTableList.{$FactionTableListCounter} == $DynamicWarEventFactionTwo)">
									<set_value name="$FactionTable.{$FactionTableList.{$FactionTableListCounter}}" exact="if $FactionTable.{$FactionTableList.{$FactionTableListCounter}}? then [$FactionTable.{$FactionTableList.{$FactionTableListCounter}} - 20, 1].max else 5" />
								</do_if>
								<do_else>
									<set_value name="$FactionTable.{$FactionTableList.{$FactionTableListCounter}}" exact="if $FactionTable.{$FactionTableList.{$FactionTableListCounter}}? then [$FactionTable.{$FactionTableList.{$FactionTableListCounter}} + 5, 50].min else 20" />
								</do_else>
							</do_all>
						</do_if>
						<!-- if factions have not been selected, we want to return a chance value -->
						<do_if value="(not $DynamicWarEventFaction?) or (not $DynamicWarEventFactionTwo?)">
							<do_all exact="$Claimspacelist.count" counter="$ClaimspaceCounter">
								<do_if value="$Claimspacelist.{$ClaimspaceCounter} != null">
									<append_to_list name="$PossibleFactionChance" exact="if $FactionTable.{$Claimspacelist.{$ClaimspaceCounter}}? then $FactionTable.{$Claimspacelist.{$ClaimspaceCounter}} else 15" />
								</do_if>
							</do_all>
						</do_if>
					</actions>
				</library>
				<library name="CalculateUiValueRepChange">
					<actions>
						<!-- 1.0 = 30		0.32 = 25		0.1 = 20		0.032 = 15		0.01 = 10		0.0032 = 5 -->
						<!-- 1.0 = 30		0.316 = 25		0.1 = 20		0.0316 = 15		0.01 = 10		0.00316 = 5 -->
						<!-- Requires $FactionOne, $FactionTwo, and $UIRelationChange -->
						<!-- Returns $NewAbsoluteRepValue and $AbsoluteRepValueChange-->
					<do_if value="$UIRelationChange != 0">
						<set_value name="$OldUIRepValue" exact="$FactionOne.relation.{$FactionOne.relationto.{$FactionTwo}}.uivalue" />
						<set_value name="$OldAbsoluteRepValue" exact="$FactionOne.relationto.{$FactionTwo}" />
						<set_value name="$RepChangeNegativeorPositiveMod" exact="if ($UIRelationChange lt 0) then (-1) else (1)" />
						<do_if value="$OldUIRepValue ge 5">
							<set_value name="$NewUIRepValue" exact="$OldUIRepValue + $UIRelationChange" />
							<set_value name="$AbsoluteRepValueChange" exact="$OldAbsoluteRepValue + $RepChangeNegativeorPositiveMod * (10^((sqrt($NewUIRepValue ^ 2)/10))/1000)" />
							<set_value name="$NewAbsoluteRepValue" exact="[(($OldAbsoluteRepValue + $AbsoluteRepValueChange) * $RepChangeNegativeorPositiveMod), 1].min" />
						</do_if>
						<do_if value="$OldUIRepValue lt 5 and $OldUIRepValue gt -5">
							<set_value name="$NewUIRepValue" exact="$OldUIRepValue + $UIRelationChange" />
							<set_value name="$AbsoluteRepValueChange" exact="$RepChangeNegativeorPositiveMod * ($UIRelationChange * 0.00064)" />
							<set_value name="$NewAbsoluteRepValue" exact="$OldAbsoluteRepValue + $AbsoluteRepValueChange" />
						</do_if>
						<do_if value="$OldUIRepValue le -5">
							<set_value name="$NewUIRepValue" exact="$OldUIRepValue + $UIRelationChange" />
							<set_value name="$AbsoluteRepValueChange" exact="$OldAbsoluteRepValue - $RepChangeNegativeorPositiveMod * (10^((sqrt($NewUIRepValue ^ 2)/10))/1000)" />
							<set_value name="$NewAbsoluteRepValue" exact="[(($OldAbsoluteRepValue - $AbsoluteRepValueChange) * $RepChangeNegativeorPositiveMod), -1].max" />
						</do_if>
					</do_if>
					</actions>
				</library>
				<library name="DynamicWarCalculateMisc">
					<actions>
						<do_if value="$DynamicWarEventFaction? and $DynamicWarEvent?">
							<do_if value="($DynamicWarEvent == 'BigBoost') or ($DynamicWarEvent == 'Besties') or ($DynamicWarEvent == 'SmallBoost')">
								<do_all exact="$Claimspacelist.count" counter="$ClaimspaceCounter">
									<set_value name="$PossibleFactionMiscModifier" exact="1" />
									<set_value name="$PrimaryRaceModifier" exact="0.1" />
									<set_value name="$MinimumRelationFactor" exact="0.75" />
									<set_value name="$CommonEnemies" exact="0" />
									<set_value name="$CommonFriends" exact="0" />
									<!-- Compare .primaryrace -->
									<!-- we will get a factor of $PrimaryRaceModifier + 1 or 1 - $PrimaryRaceModifier so 0.9-1.1-->
									<set_value name="$PossibleFactionMiscModifier" exact="$PossibleFactionMiscModifier * (if $DynamicWarEventFaction.primaryrace == $Claimspacelist.{$ClaimspaceCounter}.primaryrace then ($PrimaryRaceModifier + 1) else (1 - $PrimaryRaceModifier))" />
									<set_value name="$MiscDebug" exact="player.age + ' - ' + $Claimspacelist.{$ClaimspaceCounter}.name + ' - Primary Race Comparison Factor: ' + ($PossibleFactionMiscModifier * (if $DynamicWarEventFaction.primaryrace == $Claimspacelist.{$ClaimspaceCounter}.primaryrace then ($PrimaryRaceModifier + 1) else (1 - $PrimaryRaceModifier)))" />
									<!-- Compare current relations -->
									<!-- if we do [rawrelation + 1, $MinimumRelationFactor].max we get between a 0.75 factor and 2 -->
									<set_value name="$PossibleFactionMiscModifier" exact="$PossibleFactionMiscModifier * [($DynamicWarEventFaction.relationto.{$Claimspacelist.{$ClaimspaceCounter}} + 1), $MinimumRelationFactor].max" />
									<set_value name="$MiscDebug" exact="$MiscDebug + ' - Relation Factor: ' + [($DynamicWarEventFaction.relationto.{$Claimspacelist.{$ClaimspaceCounter}} + 1), $MinimumRelationFactor].max" />
									<!-- Compare friends and enemies -->
									<!-- enemies -->
									<get_factions_by_relation relation="killmilitary" faction="$DynamicWarEventFaction" result="$DynamicWarEventFactionEnemiesList" />
									<get_factions_by_relation relation="killmilitary" faction="$Claimspacelist.{$ClaimspaceCounter}" result="$PossibleFactionEnemiesList" />
									<get_factions_by_relation relation="member" faction="$DynamicWarEventFaction" result="$DynamicWarEventFactionFriendsList" />
									<get_factions_by_relation relation="member" faction="$Claimspacelist.{$ClaimspaceCounter}" result="$PossibleFactionFriendsList" />
									<remove_from_list name="$DynamicWarEventFactionEnemiesList" list="$ExcludedFactions" multiple="true"/>
									<remove_from_list name="$PossibleFactionEnemiesList" list="$ExcludedFactions" multiple="true"/>
									<remove_from_list name="$DynamicWarEventFactionFriendsList" list="$ExcludedFactions" multiple="true"/>
									<remove_from_list name="$PossibleFactionFriendsList" list="$ExcludedFactions" multiple="true"/>
									<do_all exact="$DynamicWarEventFactionEnemiesList.count" counter="$EnemiesCounter">
										<do_if value="$PossibleFactionEnemiesList.indexof.{$DynamicWarEventFactionEnemiesList.{$EnemiesCounter}}">
											<set_value name="$CommonEnemies" exact="$CommonEnemies + 1" />
										</do_if>
										<do_if value="$PossibleFactionFriendsList.indexof.{$DynamicWarEventFactionEnemiesList.{$EnemiesCounter}}">
											<set_value name="$CommonEnemies" exact="$CommonEnemies - 1" />
										</do_if>
									</do_all>
									<!-- friends -->
									<do_all exact="$DynamicWarEventFactionFriendsList.count" counter="$FriendsCounter">
										<do_if value="$PossibleFactionFriendsList.indexof.{$DynamicWarEventFactionFriendsList.{$FriendsCounter}}">
											<set_value name="$CommonFriends" exact="$CommonFriends + 1" />
										</do_if>
										<do_if value="$PossibleFactionEnemiesList.indexof.{$DynamicWarEventFactionFriendsList.{$FriendsCounter}}">
											<set_value name="$CommonFriends" exact="$CommonFriends - 1" />
										</do_if>
									</do_all>
									<!-- we will get a factor of 1.1 or 0.9-->
									<set_value name="$PossibleFactionMiscModifier" exact="$PossibleFactionMiscModifier * (if (($CommonFriends + $CommonEnemies) ge 0) then 1.1 else 0.9)" />
									<set_value name="$MiscDebug" exact="$MiscDebug + ' - $PossibleFactionMiscModifier: ' + $PossibleFactionMiscModifier" />
									<!-- After we calculate, add it to the list and print -->
									<set_value name="$MiscDebug" exact="$MiscDebug + ' - Common Friends/Enemies: ' + $CommonFriends + ' / ' + $CommonEnemies" />
									<debug_to_file name="'DynamicWarCalculateMisc'" directory="'DynamicWar'" text="$MiscDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
									<debug_to_file name="'DynamicWarCalculateMisc'" directory="'DynamicWar'" text="' '" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
									<append_to_list name="$PossibleFactionMiscModifierList" exact="$PossibleFactionMiscModifier" />
									<remove_value name="$PossibleFactionMiscModifier" />
									<remove_value name="$EnemiesCounter" />
									<remove_value name="$FriendsCounter" />
								</do_all>
								<remove_value name="$ClaimspaceCounter" />
							</do_if>
							<do_if value="($DynamicWarEvent == 'SmallBlow') or ($DynamicWarEvent == 'BigBlow') or ($DynamicWarEvent == 'Nemesis')">
								<do_all exact="$Claimspacelist.count" counter="$ClaimspaceCounter">
									<set_value name="$PossibleFactionMiscModifier" exact="1" />
									<set_value name="$PrimaryRaceModifier" exact="0.1" />
									<set_value name="$MinimumRelationFactor" exact="0.75" />
									<set_value name="$CommonEnemies" exact="0" />
									<set_value name="$CommonFriends" exact="0" />
									<!-- Compare .primaryrace -->
									<!-- we will get a factor of $PrimaryRaceModifier + 1 or 1 - $PrimaryRaceModifier so 0.9-1.1-->
									<set_value name="$PossibleFactionMiscModifier" exact="$PossibleFactionMiscModifier * (if $DynamicWarEventFaction.primaryrace != $Claimspacelist.{$ClaimspaceCounter}.primaryrace then ($PrimaryRaceModifier + 1) else (1 - $PrimaryRaceModifier))" />
									<set_value name="$MiscDebug" exact="player.age + ' - ' + $Claimspacelist.{$ClaimspaceCounter}.name + ' - Primary Race Comparison Factor: ' + (if $DynamicWarEventFaction.primaryrace != $Claimspacelist.{$ClaimspaceCounter}.primaryrace then ($PrimaryRaceModifier + 1) else (1 - $PrimaryRaceModifier))" />
									<!-- Compare current relations -->
									<!-- if we do [rawrelation + 1, $MinimumRelationFactor].max we get between a 0.75 factor and 2 -->
									<set_value name="$PossibleFactionMiscModifier" exact="$PossibleFactionMiscModifier * [(-$DynamicWarEventFaction.relationto.{$Claimspacelist.{$ClaimspaceCounter}} + 1), $MinimumRelationFactor].max" />
									<set_value name="$MiscDebug" exact="$MiscDebug + ' - Relation Factor: ' + [(-$DynamicWarEventFaction.relationto.{$Claimspacelist.{$ClaimspaceCounter}} + 1), $MinimumRelationFactor].max" />
									<!-- Compare friends and enemies -->
									<!-- enemies -->
									<get_factions_by_relation relation="killmilitary" faction="$DynamicWarEventFaction" result="$DynamicWarEventFactionEnemiesList" />
									<get_factions_by_relation relation="killmilitary" faction="$Claimspacelist.{$ClaimspaceCounter}" result="$PossibleFactionEnemiesList" />
									<get_factions_by_relation relation="member" faction="$DynamicWarEventFaction" result="$DynamicWarEventFactionFriendsList" />
									<get_factions_by_relation relation="member" faction="$Claimspacelist.{$ClaimspaceCounter}" result="$PossibleFactionFriendsList" />
									<remove_from_list name="$DynamicWarEventFactionEnemiesList" list="$ExcludedFactions" multiple="true"/>
									<remove_from_list name="$PossibleFactionEnemiesList" list="$ExcludedFactions" multiple="true"/>
									<remove_from_list name="$DynamicWarEventFactionFriendsList" list="$ExcludedFactions" multiple="true"/>
									<remove_from_list name="$PossibleFactionFriendsList" list="$ExcludedFactions" multiple="true"/>
									<do_all exact="$DynamicWarEventFactionEnemiesList.count" counter="$EnemiesCounter">
										<do_if value="$PossibleFactionEnemiesList.indexof.{$DynamicWarEventFactionEnemiesList.{$EnemiesCounter}}">
											<set_value name="$CommonEnemies" exact="$CommonEnemies + 1" />
										</do_if>
										<do_if value="$PossibleFactionFriendsList.indexof.{$DynamicWarEventFactionEnemiesList.{$EnemiesCounter}}">
											<set_value name="$CommonEnemies" exact="$CommonEnemies - 1" />
										</do_if>
									</do_all>
									<!-- friends -->
									<do_all exact="$DynamicWarEventFactionFriendsList.count" counter="$FriendsCounter">
										<do_if value="$PossibleFactionFriendsList.indexof.{$DynamicWarEventFactionFriendsList.{$FriendsCounter}}">
											<set_value name="$CommonFriends" exact="$CommonFriends + 1" />
										</do_if>
										<do_if value="$PossibleFactionEnemiesList.indexof.{$DynamicWarEventFactionFriendsList.{$FriendsCounter}}">
											<set_value name="$CommonFriends" exact="$CommonFriends - 1" />
										</do_if>
									</do_all>
									<!-- we will get a factor of 1.1 or 0.9-->
									<set_value name="$PossibleFactionMiscModifier" exact="$PossibleFactionMiscModifier * (if (($CommonFriends + $CommonEnemies) ge 0) then 0.9 else 1.1)" />
									<set_value name="$MiscDebug" exact="$MiscDebug + ' - $PossibleFactionMiscModifier: ' + $PossibleFactionMiscModifier" />
									<!-- After we calculate, add it to the list and print -->
									<set_value name="$MiscDebug" exact="$MiscDebug + ' - Common Friends/Enemies: ' + $CommonFriends + ' / ' + $CommonEnemies" />
									<debug_to_file name="'DynamicWarCalculateMisc'" directory="'DynamicWar'" text="$MiscDebug" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
									<debug_to_file name="'DynamicWarCalculateMisc'" directory="'DynamicWar'" text="' '" output="false" append="true" chance="if @$DynamicWarDebugChance then ($DynamicWarDebugChance * 100) else 0"/>
									<append_to_list name="$PossibleFactionMiscModifierList" exact="$PossibleFactionMiscModifier" />
									<remove_value name="$PossibleFactionMiscModifier" />
									<remove_value name="$EnemiesCounter" />
									<remove_value name="$FriendsCounter" />
								</do_all>
								<remove_value name="$ClaimspaceCounter" />
							</do_if>
						</do_if>
					</actions>
				</library>
			</cues>
		</cue>
	</cues>
</mdscript>
